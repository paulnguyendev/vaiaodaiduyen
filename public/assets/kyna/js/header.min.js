"use strict";
var headerCategoryObject = {
        moneyFormat: function (e) {
            return (
                e &&
                e.toLocaleString("it-IT", {
                    style: "currency",
                    currency: "VND",
                })
            );
        },
        htmlHeaderBannerCourse: function (e) {
            var a = "";
            return (
                e.map(function (e) {
                    a += '\n            <a class="item" href="'
                        .concat(e.slug, '" target="_blank">\n              ')
                        .concat(
                            e.is_best_seller
                                ? '<img class="ribbon" src="https://media-kyna.cdn.vccloud.vn/img/ribbon/ribbon-bestseller.png" alt="Kyna.vn">'
                                : "",
                            '\n              <div class="item-inner">\n                <div class="img-wrap">\n                  <img class="img" src="'
                        )
                        .concat(e.image_url, '" alt="')
                        .concat(
                            e.name,
                            '">\n                </div>\n                <div class="content">\n                  <div class="title">'
                        )
                        .concat(
                            e.name,
                            "</div>\n                  <div>\n                    "
                        )
                        .concat(
                            e.rating
                                ? '<div class="rating">'
                                      .concat(
                                          e.rating,
                                          '<span class="rate-icon">'
                                      )
                                      .concat(
                                          (function (e) {
                                              for (
                                                  var a = "",
                                                      n =
                                                          ((e = Math.round(e)),
                                                          0);
                                                  n < e;
                                                  n++
                                              )
                                                  a +=
                                                      '<i class="fas fa-star"></i>';
                                              for (var o = e; o < 5; o++)
                                                  a +=
                                                      '<i class="far fa-star"></i>';
                                              return a;
                                          })(e.rating),
                                          "</span></div>"
                                      )
                                : "",
                            '\n                    <div class="price">\n                      '
                        )
                        .concat(
                            e.origin_price || parseInt(e.origin_price)
                                ? '   <div class="old-price">'.concat(
                                      headerCategoryObject.moneyFormat(
                                          e.origin_price
                                      ),
                                      "</div>"
                                  )
                                : "",
                            '\n                      <div class="new-price">'
                        )
                        .concat(
                            e.price
                                ? headerCategoryObject.moneyFormat(e.price)
                                : "Miá»…n phĂ­",
                            "</div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </a>\n            "
                        );
                }),
                a
            );
        },
        hoverChildCategoryShow: function (e, a, n) {
            var o;
            if (
                (o = JSON.parse(sessionStorage.getItem("course_category"))[n])
                    .length
            ) {
                var r = headerCategoryObject.htmlHeaderBannerCourse(o);
                a.find("> .inner").html(r),
                    (e.hasClass("child-hovering") || e.hasClass("hovering")) &&
                        e.addClass("child-is-course");
            } else e.removeClass("child-is-course");
        },
        handleHoverHeaderBanner: function () {
            var e = $(".header-banner-left"),
                a = $(".header-banner-child-category"),
                n = $(".nav-item-active-js"),
                o = $(".header-banner-course");
            e &&
                (e.find(".item").hover(
                    function () {
                        var o = $(this).data("child-category");
                        n.addClass("hover"),
                            e.find("> .inner .item").removeClass("active"),
                            $(this).addClass("active"),
                            o &&
                                (e.addClass("hovering"),
                                a.find("> .inner").empty(),
                                o.map(function (e) {
                                    a.find("> .inner").append(
                                        '<a href="'
                                            .concat(
                                                e.url,
                                                '"  class="item" data-uid="'
                                            )
                                            .concat(e.id, '">')
                                            .concat(e.name, "</a>")
                                    );
                                }),
                                a
                                    .find("> .inner .item")
                                    .eq(0)
                                    .trigger("mouseenter"));
                    },
                    function () {
                        n.removeClass("hover"),
                            e.removeClass("hovering"),
                            a
                                .find("> .inner .item")
                                .eq(0)
                                .trigger("mouseleave");
                    }
                ),
                "undefined" != typeof Storage &&
                    ($(document).on(
                        "mouseenter",
                        ".header-banner-child-category .item",
                        function () {
                            e.addClass("child-hovering"),
                                a.find("> .inner .item").removeClass("active"),
                                $(this).addClass("active");
                            var n = $(this).data("uid"),
                                r = sessionStorage.getItem("course_category");
                            (r = r ? JSON.parse(r) : {}) && r[n]
                                ? headerCategoryObject.hoverChildCategoryShow(
                                      e,
                                      o,
                                      n
                                  )
                                : $.ajax({
                                      url: "/site/category-course-ajax",
                                      data: { id: n },
                                      success: function (a) {
                                          r[n]
                                              ? headerCategoryObject.hoverChildCategoryShow(
                                                    e,
                                                    o,
                                                    n
                                                )
                                              : ((r[n] = a.data),
                                                sessionStorage.setItem(
                                                    "course_category",
                                                    JSON.stringify(r)
                                                ),
                                                headerCategoryObject.hoverChildCategoryShow(
                                                    e,
                                                    o,
                                                    n
                                                ));
                                      },
                                  });
                        }
                    ),
                    $(document).on(
                        "mouseleave",
                        ".header-banner-child-category .item",
                        function () {}
                    ),
                    $(document).on(
                        "mouseenter",
                        ".header-banner-child-category",
                        function () {
                            e.addClass("child-hovering"), n.addClass("hover");
                        }
                    ),
                    $(document).on(
                        "mouseleave",
                        ".header-banner-child-category",
                        function () {
                            e.removeClass("child-hovering"),
                                e.removeClass("child-is-course"),
                                n.removeClass("hover");
                        }
                    ),
                    $(document).on(
                        "mouseenter",
                        ".header-banner-course",
                        function () {
                            e.addClass("child-hovering"),
                                e.addClass("child-is-course"),
                                n.addClass("hover");
                        }
                    ),
                    $(document).on(
                        "mouseleave",
                        ".header-banner-course",
                        function () {
                            e.removeClass("child-hovering"),
                                e.removeClass("child-is-course"),
                                n.removeClass("hover");
                        }
                    )));
        },
        handleHoverListCategory: function () {
            var e = $("#header .nav-item-active-js");
            e.length &&
                e.hover(
                    function () {
                        e.addClass("hover");
                    },
                    function () {
                        e.removeClass("hover");
                    }
                );
        },
        handleClickCategoryMobile: function () {
            var e = $("#navMobile");
            if (e.length) {
                var a = e.find(
                        '.list-category-parent-js .item[data-is-child="true"]'
                    ),
                    n = $(".header-child-category"),
                    o = $("body");
                a.on("click", function (e) {
                    e.preventDefault(),
                        $(".nav-mobile .header-left-menu > .inner").scrollTop(
                            0
                        );
                    var a = $(this).data("child-category");
                    o.addClass("menu-child-category-show"),
                        n.find(".list-category").empty(),
                        a.map(function (e) {
                            n.find(".list-category").append(
                                '<a href="'
                                    .concat(
                                        e.url,
                                        '" target="_blank" class="item" data-uid="'
                                    )
                                    .concat(e.id, '">')
                                    .concat(e.name, "</a>")
                            );
                        });
                }),
                    n.find(".go-back").length &&
                        n.find(".go-back").on("click", function () {
                            o.removeClass("menu-child-category-show");
                        });
            }
        },
        init: function () {
            headerCategoryObject.handleHoverHeaderBanner(),
                headerCategoryObject.handleHoverListCategory(),
                headerCategoryObject.handleClickCategoryMobile();
        },
    },
    header = {
        loadUserSeenCourses: function () {
            var e = JSON.parse(localStorage.getItem("userSeenCoursesV4"));
            null !== e
                ? header.renderUserSeenCourse(e)
                : $(".user-seen-course-header").html(
                      '\n        <div class="container empty">\n              <p>Báº¡n chÆ°a xem khĂ³a há»c nĂ o.</p>\n              <p>HĂ£y tiáº¿p tá»¥c khĂ¡m phĂ¡ Kyna, cĂ¡c khĂ³a há»c báº¡n Ä‘Ă£ xem sáº½ hiá»ƒn thá»‹ á»Ÿ Ä‘Ă¢y!</p>\n        </div>\n      '
                  );
        },
        renderUserSeenCourse: function (e) {
            var a = "";
            if (!e) return "";
            e.forEach(function (e) {
                if (e) {
                    var n = window.location.host;
                    a +=
                        '\n           <div class="course-header-min">\n                                <a href="https://'
                            .concat(
                                n +
                                    "/" +
                                    e.slug +
                                    "/580938?utm_source=new_header&utm_medium=last_view",
                                '" class="course-header-min__link" target="_blank">\n                                    <div class="course-header-min__image">\n                                        <img class="image"\n                                             src="'
                            )
                            .concat(
                                e.image_url,
                                '"\n                                             alt="course-image">\n                                    </div>\n                                    <div class="course-header-min__title">\n                                        <p>'
                            )
                            .concat(
                                e.name,
                                "</p>\n                                    </div>\n                                </a>\n                            </div>\n        "
                            );
                }
            }),
                $(".user-seen-course-header .container").append(a);
        },
        handleSlick: function () {
            $(".section-best-seller-header .course-special__wrapper").slick({
                arrows: !1,
                rows: 0,
                slidesToShow: 4,
                slidesToScroll: 1,
                centerMode: !0,
                variableWidth: !0,
                infinite: !0,
                autoplay: !1,
                autoplaySpeed: 5e3,
                prevArrow:
                    '<button type="button" class="slick-prev slick-arrow-lg" aria-label="slick-button"></button>',
                nextArrow:
                    '<button type="button" class="slick-next slick-arrow-lg" aria-label="slick-button"></button>',
                responsive: [
                    {
                        breakpoint: 4320,
                        settings: {
                            slidesToScroll: 1,
                            slidesToShow: 5,
                            variableWidth: !0,
                        },
                    },
                    {
                        breakpoint: 1200,
                        settings: { slidesToScroll: 1, slidesToShow: 4 },
                    },
                    {
                        breakpoint: 992,
                        settings: { slidesToScroll: 1, slidesToShow: 4 },
                    },
                    {
                        breakpoint: 768,
                        settings: { slidesToScroll: 1, slidesToShow: 4 },
                    },
                    {
                        breakpoint: 576,
                        settings: { slidesToScroll: 1, slidesToShow: 4 },
                    },
                    {
                        breakpoint: 481,
                        settings: {
                            centerMode: !1,
                            variableWidth: !1,
                            slidesToScroll: 1,
                            slidesToShow: 1,
                        },
                    },
                ],
            }),
                $(".section-best-seller-header .btn-prev").on(
                    "click",
                    function () {
                        $(
                            ".section-best-seller-header .course-special__wrapper"
                        ).slick("slickPrev");
                    }
                ),
                $(".section-best-seller-header .btn-next").on(
                    "click",
                    function () {
                        $(
                            ".section-best-seller-header .course-special__wrapper"
                        ).slick("slickNext");
                    }
                );
        },
        courseHeaderClose: function (e) {
            header.turnOffBackDrop(),
                $(e).each(function (e, a) {
                    $(a).removeClass("show");
                });
        },
        courseHeaderOpen: function (e) {
            header.turnOnBackDrop(),
                $(".course-header").each(function (a, n) {
                    $(n).hasClass(e) && $(n).addClass("show");
                });
        },
        handleHoverCourse: function () {
            $(".nav-item-course").hover(
                function () {
                    var e = this;
                    header.courseHeaderClose(".course-header"),
                        setTimeout(function () {
                            header.courseHeaderOpen($(e).data("toggle"));
                        }, 200);
                },
                function () {
                    setTimeout(function () {
                        $(".course-header:hover").length < 1 &&
                            header.courseHeaderClose(".course-header");
                    }, 200),
                        $(".course-header").mouseleave(function () {
                            setTimeout(function () {
                                header.courseHeaderClose(".course-header");
                            }, 200);
                        });
                }
            );
        },
        turnOnBackDrop: function () {
            $("body").append(
                '<div class="body-backdrop">\n        \n                </div>'
            );
        },
        turnOffBackDrop: function () {
            var e = $(".body-backdrop");
            e.length > 0 && e.remove();
        },
        handleHoverCourseBestseller: function () {
            $(".course-special__item").hover(
                function () {
                    $(this).removeClass("card-inactive"),
                        $(this).addClass("card-active");
                },
                function () {
                    $(this).removeClass("card-active"),
                        $(this).addClass("card-inactive");
                }
            );
        },
        handleDropDownActions: function () {
            $(".dropdown").hover(
                function () {
                    $(this).addClass("open");
                },
                function () {
                    setTimeout(function () {
                        $(".dropdown-menu:hover").length < 1 &&
                            $(".dropdown").removeClass("open");
                    }, 1);
                }
            );
        },
        handleClickHeaderMobile: function () {
            var e = $("#navMobile"),
                a = $("body");
            e.length &&
                (e.find(".navbar-cart_search").on("click", function () {
                    if (a.hasClass("search-show"))
                        return (
                            a.removeClass("search-show"),
                            void $(".nav-mobile-search").animate(
                                { height: 0 },
                                250
                            )
                        );
                    a.addClass("search-show"),
                        $(".nav-mobile-search").animate(
                            {
                                height: $(".nav-mobile-search")
                                    .find("> .inner")
                                    .outerHeight(),
                            },
                            250
                        );
                }),
                e.find(".navbar-burger").on("click", function () {
                    a.hasClass("menu-show")
                        ? a.removeClass("menu-show")
                        : a.addClass("menu-show");
                }),
                $(document).click(function (e) {
                    var n = $(e.target);
                    !n.closest(".header-left-menu").length &&
                        $(".header-left-menu").is(":visible") &&
                        !n.closest(".navbar-burger").length &&
                        $(".navbar-burger").is(":visible") &&
                        a.removeClass(
                            "menu-show menu-child-show menu-child-category-show"
                        );
                }),
                e.find(".btn-close").length &&
                    e.find(".btn-close").on("click", function () {
                        a.removeClass(
                            "menu-show menu-child-show menu-child-category-show"
                        );
                    }),
                e.find(".user-login").length &&
                    e.find(".user-login").on("click", function (e) {
                        e.preventDefault(),
                            a.hasClass("menu-child-show")
                                ? a.removeClass("menu-child-show")
                                : a.addClass("menu-child-show");
                    }),
                e.find(".header-user .go-back").length &&
                    e.find(".header-user .go-back").on("click", function () {
                        a.hasClass("menu-child-show")
                            ? a.removeClass("menu-child-show")
                            : a.addClass("menu-child-show");
                    }));
        },
        handleVideo: function () {
            if (!($("#video-preview__player").length < 1)) {
                var e,
                    a = videojs("video-preview__player");
                videojs("video-preview__player", {
                    controls: !0,
                    autoplay: !0,
                    preload: "metadata",
                }),
                    $(".cta-open-video").on("click", function (n) {
                        n.preventDefault(),
                            (e = $(this).attr("data-source")),
                            $("#video-modal").modal("show"),
                            a.src(e),
                            a.play();
                    }),
                    $("#video-modal").on("shown.bs.modal", function (e) {
                        a.play();
                    }),
                    $("#video-modal").on("hidden.bs.modal", function (e) {
                        a.pause();
                    });
            }
        },
        ClickDropDownCart: function () {
            $(".cart.dropdown").addClass("open"),
                $("footer").after(
                    '<div id="shadown-cart-click" style="position: fixed;top: 0;left: 0;width: 100%;height: 100%;z-index: 11;background: black;opacity: 0.5;"></div>'
                ),
                $("#shadown-cart-click").on("click", function () {
                    $(".cart.dropdown").remove("open"),
                        $("#shadown-cart-click").remove();
                }),
                setTimeout(function () {
                    $(".cart.dropdown").removeClass("open"),
                        $("#shadown-cart-click").remove();
                }, 4e3);
        },
        handleAddToCart: function () {
            $(document).on("click", "#shadown-cart-click", function () {
                $(".cart.dropdown").removeClass("open"),
                    $("#shadown-cart-click").remove();
            }),
                $(document).on("mouseleave", ".popover", function () {
                    $("body")
                        .find(".popover")
                        .each(function (e, a) {
                            $(a).fadeOut(300);
                        });
                }),
                $("body").on("click", ".add-to-cart", function (e) {
                    e.preventDefault(),
                        $("body").find(".popover").popover("hide");
                    var a = $(this).data("pid"),
                        n = $('meta[name="csrf-token"]').attr("content");
                        let url = $(this).attr('href');
                    $.ajax({
                        url: url,
                        type: "get",
                        data: { pid: a, _csrf: n },
                        success: function (e) {
                            e.result
                                ? ((countCart += 1),
                                  (sendData = !0),
                                  $(".k-header-info .cart .count-number")
                                      .html(e.totalCount)
                                      .removeClass("none-item"),
                                  $(".k-details-cart-right .count-number").html(
                                      e.totalCount
                                  ),
                                  $("#detail-icon-cart .detail-number").html(
                                      e.totalCount
                                  ),
                                  $(".add-to-cart.k-popup").length > 0 &&
                                      $(
                                          ".k-popup-lesson .k-popup-lesson-close"
                                      ).click(),
                                  $("html, body").animate(
                                      { scrollTop: 0 },
                                      200
                                  ),
                                  $("#k-header-form-cart")
                                      .parent()
                                      .replaceWith(e.content),
                                  $('*[data-id="' + a + '"]').each(function (
                                      e
                                  ) {
                                      $(this).attr("data-status-item", "3");
                                  }),
                                  $(
                                      ".add-to-cart[data-pid=".concat(a, "]")
                                  ).each(function (e, a) {
                                      $(this).removeClass(
                                          "go-to-cart add-to-cart register"
                                      ),
                                          $(this)
                                              .find("i.far")
                                              .removeClass("fa-shopping-cart")
                                              .addClass("fa-cart-plus"),
                                          $(this).addClass("already-in-cart"),
                                          $(a).hasClass("btn-outline-grey") &&
                                              $(a).click();
                                  }),
                                  header.ClickDropDownCart(),
                                  /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(
                                      navigator.userAgent
                                  ) && (window.location.href = "/gio-hang"))
                                : console.log(e.error);
                        },
                    });
                });
        },
        handleFormLoginRegister: function () {
            var e = "none" != $("#k-popup-account-register").css("display"),
                a = "none" != $("#k-popup-account-login").css("display");
            $(document).on("click", ".header-login", function () {
                a && $("#k-popup-account-login").css("display", "none");
            }),
                $(document).on("click", 'a[href="/dang-ky"]', function () {
                    e && $("#k-popup-account-login").css("display", "none");
                });
        },
        init: function () {
            header.loadUserSeenCourses(),
                header.handleSlick(),
                header.handleHoverCourse(),
                header.handleHoverCourseBestseller(),
                header.handleDropDownActions(),
                header.handleClickHeaderMobile(),
                header.handleVideo(),
                header.handleAddToCart(),
                header.handleFormLoginRegister();
        },
    };
$(document).ready(function () {
    headerCategoryObject.init(), header.init();
});
